<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Administration - Daiquiri documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../style.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Administration";
        var mkdocs_page_input_path = "administration.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Daiquiri documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../installation/">Installation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../deployment/">Deployment</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../settings/">Settings</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Administration</a>
    <ul class="current">
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../management/">Management</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../advanced/">Advanced features</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../oai-metadata/">OAI Metadata</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Daiquiri documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Administration</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="administration">Administration</h2>
<h2 id="admin-interface">Admin interface</h2>
<p>Daiquiri uses the <a href="https://docs.djangoproject.com/en/4.2/ref/contrib/admin/">Django Admin interfaca</a>
as an interface for admins to intereact with a particular Daiquiri site. Please
refer to the Django documentation for a detailed guide. Here we summarize the
most important options:</p>
<h4 id="site-configuration">Site configuration</h4>
<p>Daiquiri uses Django&rsquo;s <a href="https://docs.djangoproject.com/en/4.2/ref/contrib/sites">sites framework</a>.
It is therefore necesary to configure the <strong>Domain name</strong> and the
<strong>Display name</strong> of your Daiquiri installation. This can be done in the admin
interface under <em>SITE</em>.</p>
<h4 id="users-and-groups">Users and Groups</h4>
<p>The users and groups of your Daiquiri site can be managed under
<strong>AUTHENTICATION AND AUTHORIZATION</strong>. You can create and update users and set
their password directly, but most of the time this will be done by the users
themselves using the account menu.</p>
<p>The user created in the installation process can access all features of
Daiquiri. In order to allow other users to access the management or the admin
interface, they need to have the required permissions assigned to them. This
can be done in two ways: through groups or using the superuser flag.</p>
<h4 id="social-accounts">Social accounts</h4>
<p>Using the <a href="https://www.intenct.nl/projects/django-allauth/">django-allauth</a>,
social authentication using the OAuth2 protocol can be used with Daiquiri.
For this <code>'allauth.socialaccount'</code> and, e.g. for GitHub,
<code>'allauth.socialaccount.providers.github'</code> need to be added to <code>INSTALLED_APPS</code>
in <code>base.py</code>. In addition, your app needs to be registered with the provider.
The callback url needed for the registration is</p>
<pre><code>&lt;site url&gt;/account/&lt;provider&gt;/login/callback/
</code></pre>
<p>Once the credentials are obtained, you need to enter them in the admin
interface under SOCIAL ACCOUNTS. Click on Add social application and:</p>
<ol>
<li>Select the corresponding provider</li>
<li>Enter a Name of your choice</li>
<li>Enter the Client id (or App ID) and the Secret key (or Client secret, Client key, App Secret)</li>
<li>Add your site to the chosen sites.</li>
<li>Click save.</li>
</ol>
<h2 id="command-line-tools">Command line tools</h2>
<p>In addition the web interface, Daiquiri provides several commands to inter, which can be</p>
<h4 id="setup-groups">Setup groups</h4>
<p>The permission system of Daiquiri utilizes a set of groups to manage access to
the management interfaces and the WordPress integration. These groups can be
created using:</p>
<pre><code class="language-bash">python manage.py setup_groups
</code></pre>
<p>The groups creates are:</p>
<pre><code>contact_manager
meetings_manager
metadata_manager
stats_manager
query_manager
user_manager
</code></pre>
<h4 id="setup-tap_schema">Setup TAP_SCHEMA</h4>
<p>In order to setup the metadata for the TAP_SCHEMA run the following command
(in your virtual environment):</p>
<pre><code class="language-bash">python manage.py setup_tap_metadata
</code></pre>
<p>After this, <em>/metadata/management/</em> should show a schema entry for the <code>tap_schema</code>.</p>
<h4 id="rebuild-tap_schema">Rebuild TAP_SCHEMA</h4>
<p>The metadata is automatically synced between the metadata and the the
TAP_SCHEMA. In order to rebuild the TAP_SCHEMA from scratch, you can use:</p>
<pre><code class="language-bash">python manage.py rebuild_tap_schema
</code></pre>
<h4 id="rebuild-datalink_table">Rebuild DATALINK_TABLE</h4>
<p>The global datalink table is partly used for metadata management. DOI and
related identifier entries for public schemas and tables with a doi field are
automatically generated. Additionally, all declared extra datalink tables
(see <code>DATALINK_TABLES</code> setting variable) will be gathered and ingested into
the global datalink table. The global datalink table is in the <code>TAP_SCHEMA</code>.
It is publically available and can be queried via TAP. The extra datalink
table should stay <code>PRIVATE</code>.</p>
<p>To resync the global datalink table with the metadata, and new extra datalink
tables, you can use:</p>
<pre><code class="language-bash">python manage.py rebuild_datalink_table
</code></pre>
<h4 id="rebuild-oai-schema">Rebuild OAI Schema</h4>
<p>Similar to the TAP_SCHEMA, the records for the OAI-PMH interface are located
in a seperate schema, whithin the scientific database. In order to create the
<code>oai_schema</code> from scratch, use:</p>
<pre><code class="language-bash">python manage.py rebuild_oai_schema
</code></pre>
<p>Be aware that the OAI schema requires an up-to-date datalink table. So the
datalink app should be activated, the global datalink table should exists:
<code>setup_tap_schema</code>, and up-to-date: <code>rebuild_datalink_table</code>.</p>
<h4 id="dump-fixtures">Dump Fixtures</h4>
<pre><code class="language-bash"># extract examples
python manage.py dumpdata daiquiri_query.example &gt; examples.json

# extract files
python manage.py dumpdata daiquiri_files.directory &gt; directories.json

# extract functions
python manage.py dumpdata daiquiri_metadata.function &gt; functions.json

# extract groups
python manage.py dumpdata auth.group &gt; groups.json

# extract users
python manage.py dumpdata auth.user daiquiri_auth.profile account.emailaddress socialaccount &gt; users.json

# extract announcement messages
python manage.py dumpdata daiquiri_contact.annoucementmessage &gt; announcement_messages.json
</code></pre>
<h4 id="load-fixtures">Load Fixtures</h4>
<pre><code class="language-bash"># load examples
python manage.py loaddata examples.json

# load files
python manage.py loaddata directories.json

# load functions
python manage.py loaddata functions.json

# load groups
python manage.py loaddata groups.json

# load users
python manage.py loaddata users.json

# load announcement messages
python manage.py loaddata announcement_messages.json
</code></pre>
<h4 id="setup-the-scientific-database">Setup the scientific database</h4>
<p>For helping the administrator in properly creating the scientific database,
you can use:</p>
<pre><code class="language-bash">python manage.py sqlcreate
</code></pre>
<p>Note: on the contrary to its name sqlcreate do not create anything, it just
prints the SQL statement to properly create the science tables.</p>
<p>For the extra datalink tables, you can use:</p>
<pre><code class="language-bash">python manage.py sqlcreate --datalink=&lt;extra-datalink-tablename&gt;
</code></pre>
<h4 id="notes-on-datalink">Notes on datalink</h4>
<p>The extra datalink tables have four purposes:</p>
<ol>
<li>improving the metadata with non-standard entries</li>
<li>creating relation between objects and groups</li>
<li>simplifying the discovery and access of files</li>
<li>declaring cross-table information for given object</li>
</ol>
<h5 id="improving-the-metadata">Improving the metadata</h5>
<p>For the tables and schemas with a DOI, the command <code>rebuild_datalink_table</code>
creates three datalink entries for each table/schema relating their names to
their documentation, related identifier and the DOI url. However, not only
tables and schema may have DOI, also objects or groups of objects may also
have DOIs. In this case, it is possible to use the extra datalink tables to
create the relation between objects and their DOIs.</p>
<p>The extra datalink tables should be named like: <code>&lt;release_schema&gt;.&lt;object_category&gt;_doi</code>.
The table should be filled as follow:</p>
<ol>
<li>the <code>ID</code> should contain the unique string identifying the object in the database: <code>&lt;object_id&gt;</code></li>
<li>the <code>access_url</code> is for the <code>&lt;doi_url&gt;</code></li>
<li>the <code>semantics</code> is always <code>#doi</code> in this datalink table.</li>
</ol>
<p>After executing the commands <code>rebuild_datalink_table</code> and <code>rebuild_oai_schema</code>,
the objects will have entries in both, the global datalink table and the oai schema.
The first ones can be queried via <code>TAP_SCHEMA.datalink</code> and the second via the <code>OAI-PMH</code> api.</p>
<p>The following table lists additional datalink entries that can be used for every objects to enrich the metadata for <code>OAI-PMH</code></p>
<table>
<thead>
<tr>
<th><strong>semantic</strong></th>
<th><strong>OAI-PMH entry</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>#this</td>
<td><code>&lt;relatedIdentifier relatedIdentifierType="URL" relationType="IsDescribedBy"&gt;access_url&lt;/relatedIdentifier&gt;</code></td>
</tr>
<tr>
<td>#preview</td>
<td><code>&lt;alternateIdentifier alternateIdentifierType="DOI Landing Page"&gt;access_url&lt;/alternateIdentifier&gt;</code></td>
</tr>
<tr>
<td>#preview-image</td>
<td><code>&lt;relatedIdentifier relatedIdentifierType="URL" relationType="IsSupplementedBy"&gt;access_url&lt;/relatedIdentifier&gt;</code></td>
</tr>
<tr>
<td>#detached-header</td>
<td><code>&lt;relatedIdentifier relatedIdentifierType="URL" relationType="IsSupplementedBy"&gt;access_url&lt;/relatedIdentifier&gt;</code></td>
</tr>
<tr>
<td>#documentation</td>
<td><code>&lt;relatedIdentifier relatedIdentifierType="URL" relationType="IsDocumentedBy"&gt;access_url&lt;/relatedIdentifier&gt;</code></td>
</tr>
<tr>
<td>#progenitor</td>
<td><code>&lt;relatedIdentifier relatedIdentifierType="URL" relationType="IsDerivedFrom"&gt;access_url&lt;/relatedIdentifier&gt;</code></td>
</tr>
<tr>
<td>#auxiliary</td>
<td><code>&lt;relatedIdentifier relatedIdentifierType="URL" relationType="References"&gt;access_url&lt;/relatedIdentifier&gt;</code></td>
</tr>
</tbody>
</table>
<p>The examples for the use of the semantics are 
| <strong>semantic</strong>     | <strong>Used for&hellip;</strong>                                                                                                 |
|------------------|-----------------------------------------------------------------------------------------------------------------|
| #this            | fits, hdf5, csv files, and resources holding the data                                                           |
| #preview         | viewers and doi-landing pages                                                                                   |
| #preview-image   | png, jpeg holding the represantation of the data                                                                |
| #detached-header | fits header, e.g., from previous releases                                                                       |
| #documentation   | related documentation pages                                                                                     |</p>
<p>More info on semantics: https://www.ivoa.net/rdf/datalink/core</p>
<p>In Daiquiri, it is possible to create additional custom semantics by using
the settings variable <code>DATALINK_CUSTOM_SEMANTICS</code>. For instance, the daiquiri
specific custom sematic <code>#doi</code> is defined as</p>
<pre><code class="language-python">DATALINK_CUSTOM_SEMANTICS = {
    &quot;#doi&quot;: &quot;The access_url points to the Digital Object Identifier (DOI) of the object.&quot;,
}
</code></pre>
<h5 id="creating-relation-between-object-and-groups">Creating relation between object and groups</h5>
<p>Several objects may be part of a group of objects, i.e.: fields, observations,
survey, etc. In order to create a discoverable link, it is possible to use the extra datalink tables.</p>
<p>The extra datalink table should names like: <code>&lt;release_schema&gt;.&lt;group_category&gt;_datalink</code>.
The table should be filled as follows:</p>
<p>1.<code>ID</code>:  <code>&lt;group_name&gt;/&lt;group_id&gt;</code>
2.<code>access_url</code>: url pointing to the linked ressource
3.<code>semantics</code>: depends on the linked ressource</p>
<p>This way after <code>rebuild_datalink_table</code> and <code>rebuild_oai_schema</code> the groups
will have entries in both the global datalink table and the oai schema.</p>
<p>Note that a OAI Set with the group name is automatically created in the
OAI schema, if the <code>ID</code> is build like <code>&lt;group_name&gt;/&lt;group_id&gt;</code>.</p>
<h5 id="simplifying-file-access">Simplifying file access</h5>
<p>Often, the objects are provided not only in a from of a database record but
also as a downloadable file (.fits, .png, etc). This is the main use-case for
the datalink protocol. The files can be linked with the corresponding database
object using a separate datalink table.</p>
<p>The extra datalink table should be named like: <code>&lt;release_schema&gt;.&lt;object_categoty&gt;_files</code>.
The table should be filled as follow:</p>
<ol>
<li>the <code>ID</code> field should be filled with <code>&lt;object_id&gt;</code></li>
<li>the <code>access_url</code> should be filled with the downloadable url of the file</li>
<li>the <code>semantics</code> should be filled with the relevant value, i.e.: https://www.ivoa.net/rdf/datalink/core/2022-01-27/datalink.html</li>
<li>the <code>content_type</code> should be filled with the relevant value: i.e.: http://www.iana.org/assignments/media-types/media-types.xhtml</li>
<li>the <code>content_size</code> should be filled with the size of the file in bytes.</li>
</ol>
<p>This way after <code>rebuild_datalink_table</code> and the object will have entries
linking to the download links of related files in the global datalink table,
queriable either via <code>TAP_SCHEMA.datalink</code> or the datalink protocol, e.g. <code>/datalink/links?ID=&lt;objects_id&gt;</code>.</p>
<h5 id="declaring-cross-tables-information-for-given-objects">Declaring cross-tables information for given objects</h5>
<p>Usually it may be relevant to split the information on object over sevral tables.
Especially if the object somehow differ from nature and do not hold information
in all tables. Typically light sources in the sky may be either stellar
objects, galaxies, etc. These objects share informations in a main table,
but specific information are spearded over various annex tables.</p>
<p>In this case it is usefull to provide in the main table flags to declare
the existance of specific information in an annex table.
Typically <code>stellar_flag</code>, <code>galaxy_flag</code>&hellip; these flags can be queried via TAP
and convinienty helps the user to find his/her way through the database.</p>
<p>However, this still requires a knowledge about the naming and the existance
of these flags. This is not sufficient for blind discovery. In order to allow
user to blindly discover further specific information in annex tables, the extra datalink tables can be used:</p>
<p>The extra datalink table should named like: <code>&lt;release_schema&gt;.&lt;object_category&gt;_annex</code>
The table should be filled as follow:</p>
<ol>
<li>the <code>ID</code> should be filled with the unique string identifying the object in the database: <code>&lt;object _id&gt;</code></li>
<li>the <code>access_url</code> should be filled with the <code>&lt;doi_url&gt;</code> of the annex table, or its datalink url</li>
<li>the <code>semantics</code> field should be filled with <code>#auxilliary</code></li>
</ol>
<p>This way after <code>rebuild_datalink_table</code> the object will have blindly
discoverable auxilliary information, that can be queried via TAP. The name
of the table where the information can be found is present in the <code>access_url</code>
and the <code>value</code> to query is the <code>ID</code> value.</p>
<p>Notes: for a large number of objects, this method must not be employed because
the datalink table may become much to large and dynamic datalink feature
(not yet implemented) should be used instead.</p>
<h1 id="metadata-trigerring-features">Metadata trigerring features</h1>
<h2 id="ucd">ucd</h2>
<h3 id="metaref">meta.ref</h3>
<p>Declares a column to be a reference. In the results tap of the query, this
column will be rendered as a link toward the custom resolver (<code>resolver.py</code>).
The value of the column will be passed to the custom resolver to allow value
specific rendering.</p>
<h3 id="metamain">meta.main</h3>
<p>Declares a column as MAIN. This metadata identify the given column as a major
contribution to the information of the table, this will be used by various
daiquiri services to present information: conesearch and default viewer.</p>
<h4 id="conesearch">Conesearch</h4>
<p>The VO Conesearch service accepts to select either the entire tables dataset,
a reduced sub-set, or just identifer and position information. The reduced
sub-set is defined via the metadata <code>meta.main</code>.</p>
<h4 id="default-viewer">Default viewer</h4>
<p>In the default viewer, in case a table is provided as additional information
in the datalink entries of a given object, a query on the columns marked as
<code>meta.main</code> will be submitted.</p>
<h3 id="metaid">meta.id</h3>
<p>This declares a column to be the datalink ID of the table. In combination
with <code>meta.ref</code> the column link will directly to the datalink viewer.</p>
<h3 id="metarefmetafile">meta.ref;meta.file</h3>
<p>This declares a column to be the path to a FILE, it will be rendered as
an URL and redirects to a download.</p>
<h3 id="metarefmetaimage">meta.ref;meta.image</h3>
<p>This declares a column to be the path to a PREVIEW, it will be rendered
as an URL and redirects to a front-view of the image with a download button.</p>
<h2 id="datatype-and-arraysize">datatype and arraysize</h2>
<p>supported types:</p>
<ul>
<li>char</li>
<li>boolean</li>
<li>short</li>
<li>int</li>
<li>long</li>
<li>float</li>
<li>double</li>
<li>spoint (ADQL)</li>
</ul>
<p>supported array types:</p>
<ul>
<li>short</li>
<li>int</li>
<li>long</li>
<li>float</li>
<li>double</li>
<li>boolean</li>
</ul>
<h3 id="array-of-known-dimension">array of known dimension</h3>
<p>For array of known dimension the metadata should be:</p>
<pre><code>datatype: &lt;type&gt;[]
arraysize: &lt;size&gt;
</code></pre>
<h3 id="array-of-unknown-dimension">array of unknown dimension</h3>
<p>For array of unknown dimension the metadata should be:</p>
<pre><code>datatype: &lt;type&gt;[]
arraysize: None (null)
</code></pre>
<h3 id="notes-on-postgres-array-storage">Notes on Postgres array storage</h3>
<p>On postgres side array should be stored as <code>ARRAY</code> of type <code>_&lt;type&gt;</code>.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../settings/" class="btn btn-neutral float-left" title="Settings"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../management/" class="btn btn-neutral float-right" title="Management">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../settings/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../management/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
